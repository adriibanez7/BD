-- EJERCICIO 1 --
SELECT
	g.NOMBRE AS NOMBRE_GRUPO,
	ROUND(AVG(p.SETS_LOCAL), 2) AS MEDIA_SETS
FROM
	GRUPO g
LEFT JOIN EQUIPO_GRUPO eg ON
	g.PK_ID_GRUPO = eg.FK_ID_GRUPO
LEFT JOIN EQUIPO e ON
	eg.FK_ID_EQUIPO = e.PK_ID_EQUIPO
LEFT JOIN PARTIDO p ON
	e.PK_ID_EQUIPO = p.FK_ID_EQUIPO_LOCAL
WHERE
	g.PK_ID_GRUPO = (
	SELECT
		g2.PK_ID_GRUPO
	FROM
		GRUPO g2
	LEFT JOIN EQUIPO_GRUPO eg2 ON
		g2.PK_ID_GRUPO = eg2.FK_ID_GRUPO
	LEFT JOIN EQUIPO e2 ON
		eg2.FK_ID_EQUIPO = e2.PK_ID_EQUIPO
	LEFT JOIN JUGADOR j2 ON
		e2.PK_ID_EQUIPO = j2.FK_ID_EQUIPO
	ORDER BY
		YEAR(NOW()) - YEAR(j2.FECHA_NACIMIENTO) ASC
	LIMIT 1
)
GROUP BY
	g.PK_ID_GRUPO,
	g.NOMBRE;


-- EJERCICIO 2 --
SELECT
	g.NOMBRE AS NOMBRE_GRUPO,
	e.NOMBRE AS NOMBRE_EQUIPO,
	AVG(YEAR(NOW()) - YEAR(j.FECHA_NACIMIENTO)) AS EDAD_PROMEDIO
FROM
	GRUPO g
LEFT JOIN EQUIPO_GRUPO eg ON
	g.PK_ID_GRUPO = eg.FK_ID_GRUPO
LEFT JOIN EQUIPO e ON
	eg.FK_ID_EQUIPO = e.PK_ID_EQUIPO
LEFT JOIN JUGADOR j ON
	e.PK_ID_EQUIPO = j.FK_ID_EQUIPO
GROUP BY
	g.PK_ID_GRUPO,
	g.NOMBRE,
	e.PK_ID_EQUIPO,
	e.NOMBRE
ORDER BY
	EDAD_PROMEDIO ASC;


-- EJERCICIO 4 --
SET
lc_time_names = 'es_ES';

SELECT
	CONCAT(e.NOMBRE, ' ', e.APELLIDO_1, ' ', e.APELLIDO_2) as NOM_ENTRENADOR,
	DATE_FORMAT(e.FECHA_NACIMIENTO, '%e de %M de %Y') AS FECHA_NACIMIENTO,
	YEAR(NOW())- YEAR(FECHA_NACIMIENTO) as EDAD
FROM
	ENTRENADOR e
WHERE
	MONTH(e.FECHA_NACIMIENTO) = 8;


-- EJERCICIO 5 --
SELECT
	p.PK_ID_PARTIDO,
	DATE_FORMAT(p.FECHA_PARTIDO, '%e de %M de %Y') AS FECHA,
	e_local.NOMBRE AS EQUIPO_LOCAL,
	e_visitante.NOMBRE AS EQUIPO_VISITANTE,
	p.SETS_LOCAL,
	p.SETS_VISITANTE
FROM
	PARTIDO p
JOIN EQUIPO e_local ON
	p.FK_ID_EQUIPO_LOCAL = e_local.PK_ID_EQUIPO
JOIN EQUIPO e_visitante ON
	p.FK_ID_EQUIPO_VISITANTE = e_visitante.PK_ID_EQUIPO
WHERE
	MONTH(p.FECHA_PARTIDO) = MONTH(DATE_ADD(NOW(), INTERVAL 1 MONTH)) ;
-- EJERCICIO 6 --
  SELECT
	CONCAT(j.NOMBRE, ' ' , j.APELLIDO_1, ' ' , j.APELLIDO_2, ' => ', g.NOMBRE) as INFO_JUGADOR
FROM
	JUGADOR j
JOIN EQUIPO e on
	e.PK_ID_EQUIPO = j.FK_ID_EQUIPO
JOIN EQUIPO_GRUPO eg ON
	e.PK_ID_EQUIPO = eg.FK_ID_EQUIPO
JOIN GRUPO g ON
	eg.FK_ID_GRUPO = g.PK_ID_GRUPO;
