-- EJERCICIO 1 --
SELECT
	j.NOMBRE as NOMBRE_JUGADOR,
	CONCAT(j.APELLIDO_1,' ', j.APELLIDO_2 ) as APELLIDOS,
	j.DNI as DNI_JUGADOR,
	en.DNI as DNI_ENTRENADOR
FROM
	JUGADOR j
JOIN EQUIPO e ON
	j.FK_ID_EQUIPO = e.PK_ID_EQUIPO
JOIN ENTRENADOR en ON
	e.FK_ID_ENTRENADOR = en.PK_ID_ENTRENADOR ;

-- EJERCICIO 2 --
SELECT
	j.NOMBRE as NOMBRE_JUGADOR,
	CONCAT(j.APELLIDO_1,' ', j.APELLIDO_2 ) as APELLIDOS,
	j.DNI as DNI_JUGADOR,
	COALESCE(e.NOMBRE,'SIN_EQUIPO') as EQUIPO
FROM
	JUGADOR j
LEFT JOIN EQUIPO e ON
	e.PK_ID_EQUIPO = j.FK_ID_EQUIPO;

-- EJERCICIO 3 --
SELECT P2.NOMBRE AS NOMBRE_PROVINCIA, COALESCE (COUNT(J.PK_ID_JUGADOR), 0) AS NUMERO_DE_JUGADORES
FROM PROVINCIA P2
LEFT JOIN POBLACION PO ON P2.PK_ID_PROVINCIA = PO.FK_ID_PROVINCIA
LEFT JOIN JUGADOR J ON PO.PK_ID_POBLACION = J.FK_ID_POBLACION
GROUP BY P2.PK_ID_PROVINCIA, P2.NOMBRE;

-- EJERCICIO 4 --
SELECT
    G.NOMBRE AS NOMBRE_GRUPO,
    IF(COUNT(J.PK_ID_JUGADOR) > 2, 'Veteranos', 'JÃ³venes') AS CATEGORIA
FROM GRUPO G
LEFT JOIN EQUIPO_GRUPO EG ON G.PK_ID_GRUPO = EG.FK_ID_GRUPO
LEFT JOIN EQUIPO E ON EG.FK_ID_EQUIPO = E.PK_ID_EQUIPO
LEFT JOIN JUGADOR J ON E.PK_ID_EQUIPO = J.FK_ID_EQUIPO
WHERE YEAR(J.FECHA_NACIMIENTO) <= 1993 OR J.FECHA_NACIMIENTO IS NULL
GROUP BY G.PK_ID_GRUPO, G.NOMBRE;

-- EJERCICIO5 --
SELECT j.nombre,SUM(
    CASE
      WHEN p.FK_ID_EQUIPO_LOCAL = j.FK_ID_EQUIPO
      THEN p.SETS_LOCAL
      WHEN p.FK_ID_EQUIPO_VISITANTE = j.FK_ID_EQUIPO
      THEN p.SETS_VISITANTE
    END
  )AS SETS_GANADOS
FROM JUGADOR j
 JOIN EQUIPO e ON e.PK_ID_EQUIPO = j.FK_ID_EQUIPO
 JOIN PARTIDO p ON e.PK_ID_EQUIPO = p.FK_ID_EQUIPO_LOCAL
GROUP BY  j.nombre
ORDER BY SUM(CASE
      WHEN p.FK_ID_EQUIPO_LOCAL = j.FK_ID_EQUIPO
      THEN p.SETS_LOCAL
      WHEN p.FK_ID_EQUIPO_VISITANTE = j.FK_ID_EQUIPO
      THEN p.SETS_VISITANTE
    END
   )
   DESC
   LIMIT 9999 OFFSET 2;
